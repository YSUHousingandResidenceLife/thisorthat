<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>This or That — Housing Edition (Editor)</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Bungee&display=swap" rel="stylesheet" />

<style>
html,body{height:100%;margin:0}
#map{position:absolute;inset:0}

/* ===== HUD ===== */
#hud{
  position:absolute;
  bottom:28px;
  left:50%;
  transform:translateX(-50%);
  z-index:20;
  width:92%;
  max-width:900px;
  font-family:'Bungee',system-ui;
}

.title{
  background:linear-gradient(90deg,#22c55e,#06b6d4,#a855f7);
  color:white;
  padding:18px;
  border-radius:18px;
  border:6px solid #000;
  text-align:center;
  font-size:1.6rem;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  margin-bottom:14px;
}

.question{
  background:#fde047;
  border:6px solid #000;
  border-radius:16px;
  padding:18px;
  text-align:center;
  font-size:1.8rem;
  margin-bottom:16px;
}

.answers{
  display:flex;
  gap:18px;
}

.answer{
  flex:1;
  padding:26px 20px;
  border-radius:18px;
  border:6px solid #000;
  cursor:pointer;
  text-align:center;
  font-size:1.2rem;
  text-transform:uppercase;
  transition:.15s;
  box-shadow:0 10px 0 #000;
}

.answer.left{
  background:#22c55e;
  color:#052e16;
}
.answer.right{
  background:#ef4444;
  color:#450a0a;
}

.answer:hover{
  transform:translateY(-6px);
  box-shadow:0 16px 0 #000;
}
.answer:active{
  transform:translateY(4px);
  box-shadow:0 6px 0 #000;
}

/* ===== EDIT PANEL ===== */
.panel{
  position:absolute;
  top:12px;
  left:12px;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(4px);
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.15);
  padding:10px 12px;
  font:14px/1.3 system-ui;
  z-index:21;
}
.buttons{display:flex;gap:8px;flex-wrap:wrap}
button{
  border:none;cursor:pointer;padding:8px 10px;
  border-radius:10px;background:#111;color:#fff;font-weight:700
}
button.ghost{background:#f2f2f2;color:#111}
button.secondary{background:#E4002B}
</style>
</head>

<body>

<div id="map"></div>

<!-- HUD -->
<div id="hud">
  <div class="title">THIS OR THAT — HOUSING EDITION</div>
  <div class="question" id="qText"></div>
  <div class="answers">
    <div class="answer left" id="aLeft"></div>
    <div class="answer right" id="aRight"></div>
  </div>
</div>

<!-- PANEL -->
<div class="panel">
  <div class="buttons">
    <button class="ghost" onclick="undo()">Undo</button>
    <button class="ghost" onclick="clearAll()">Clear</button>
    <button class="secondary" onclick="download()">Download JSON</button>
  </div>
</div>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
<script>
/* ===== QUESTIONS (FROM GAME) ===== */
const questions = [
  { q:"HOUSING VIBE?", l:"Activities & Social", r:"Privacy & Quiet", loc:[-80.6482,41.1025] },
  { q:"SOCIAL STYLE?", l:"Meet Students", r:"Keep to Myself", loc:[-80.6485,41.1035] },
  { q:"DINING?", l:"Order & Eat", r:"Grocery & Cooking", loc:[-80.6490,41.1045] },
  { q:"RESIDENCY?", l:"Summers at Home", r:"Live Year-Round", loc:[-80.6500,41.1060] },
  { q:"FINANCES?", l:"One Bill / Aid", r:"Monthly Budget", loc:[-80.6515,41.1075] },
  { q:"SUPPORT?", l:"24/7 Staff Support", r:"Indie Problem Solving", loc:[-80.6505,41.1090] },
  { q:"CLEANING?", l:"Clean My Room", r:"Room, Bath & Living", loc:[-80.6480,41.1085] },
  { q:"CONTRACT?", l:"Flexible Study", r:"1-Year Lease", loc:[-80.6465,41.1072] }
];

let qIndex = 0;
const lights = { type:'FeatureCollection', features:[] };

/* ===== MAP ===== */
mapboxgl.accessToken =
'pk.eyJ1IjoieXN1LWhybCIsImEiOiJjbWZtcjVkNXUwNTJkMmxvaDZpaTF6b2x2In0.8-4W7BoAy5GmwM2_-L_Jzw';

const map = new mapboxgl.Map({
  container:'map',
  style:'mapbox://styles/ysu-hrl/cmfpr50qm00a401ry0uzb5b1q',
  center:questions[0].loc,
  zoom:16.8,
  pitch:60,
  bearing:-133.6
});

map.on('load',()=>{
  map.loadImage('traffic-light.png',(e,img)=>{
    if(e) throw e;
    map.addImage('traffic-light',img,{pixelRatio:2});
  });

  map.addSource('lights',{type:'geojson',data:lights});
  map.addLayer({
    id:'lights-layer',
    type:'symbol',
    source:'lights',
    layout:{
      'icon-image':'traffic-light',
      'icon-size':0.45,
      'icon-anchor':'bottom',
      'icon-allow-overlap':true
    },
    paint:{
      'icon-color':[
        'match',['get','signal'],
        'green','#22c55e',
        'red','#ef4444',
        '#ffffff'
      ]
    }
  });

  renderQuestion();
});

/* ===== CORE ===== */
function renderQuestion(){
  if(!questions[qIndex]){
    document.getElementById('qText').innerText = 'ALL QUESTIONS PLACED';
    document.querySelector('.answers').style.display='none';
    return;
  }
  const q = questions[qIndex];
  qText.innerText = q.q;
  aLeft.innerText = q.l;
  aRight.innerText = q.r;
  map.flyTo({ center:q.loc, speed:0.9, curve:1.2 });
}

function choose(side){
  const q = questions[qIndex];
  const signal = side === 'left' ? 'green' : 'red';

  lights.features.push({
    type:'Feature',
    geometry:{ type:'Point', coordinates:q.loc },
    properties:{
      qIndex,
      question:q.q,
      left:q.l,
      right:q.r,
      signal
    }
  });

  map.getSource('lights').setData(lights);
  qIndex++;
  renderQuestion();
}

function undo(){
  if(!lights.features.length) return;
  lights.features.pop();
  qIndex = Math.max(0,qIndex-1);
  renderQuestion();
}

function clearAll(){
  lights.features.length = 0;
  qIndex = 0;
  renderQuestion();
}

function download(){
  const blob = new Blob([JSON.stringify(lights,null,2)],{type:'application/geo+json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'race_traffic_lights.geojson';
  a.click();
}

/* ===== EVENTS ===== */
aLeft.onclick = ()=>choose('left');
aRight.onclick = ()=>choose('right');
</script>

</body>
</html>
